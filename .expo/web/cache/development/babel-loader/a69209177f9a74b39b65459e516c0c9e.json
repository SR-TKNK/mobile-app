{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nvar _jsxFileName = \"C:\\\\Users\\\\PC\\\\Documents\\\\hocnhieuchut\\\\reactnative\\\\mobile-app\\\\App.js\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport * as React from \"react\";\nimport View from \"react-native-web/dist/exports/View\";\nimport ActivityIndicator from \"react-native-web/dist/exports/ActivityIndicator\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport { NavigationContainer } from \"@react-navigation/native\";\nimport { createDrawerNavigator } from \"@react-navigation/drawer\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\nimport axios from \"axios\";\nimport MainTabScreen from \"./screens/RootDrawer/MainTabScreen\";\nimport HistoryScreen from \"./screens/RootDrawer/HistoryScreen\";\nimport GenerateQRScreen from \"./screens/RootDrawer/GenerateQRScreen\";\nimport SearchScreen from \"./screens/RootDrawer/SearchScreen\";\nimport PromotionsScreen from \"./screens/RootDrawer/PromotionsScreen\";\nimport SettingsScreen from \"./screens/RootDrawer/SettingsScreen\";\nimport SupportScreen from \"./screens/RootDrawer/SupportScreen\";\nimport RootStackScreen from \"./screens/RootStack/RootStackScreen\";\nimport { DrawerContent } from \"./screens/DrawerContent\";\nimport { AuthContext } from \"./components/context\";\nvar Drawer = createDrawerNavigator();\n\nfunction App() {\n  var initialLoginState = {\n    isLoading: true,\n    userName: null,\n    userToken: null\n  };\n\n  var loginReducer = function loginReducer(prevState, action) {\n    switch (action.type) {\n      case \"RETRIEVE_TOKEN\":\n        return _objectSpread(_objectSpread({}, prevState), {}, {\n          userToken: action.token,\n          isLoading: false\n        });\n\n      case \"LOGIN\":\n        return _objectSpread(_objectSpread({}, prevState), {}, {\n          userName: action.id,\n          userToken: action.token,\n          isLoading: false\n        });\n\n      case \"LOGOUT\":\n        return _objectSpread(_objectSpread({}, prevState), {}, {\n          userName: null,\n          userToken: null,\n          isLoading: false\n        });\n    }\n  };\n\n  var _React$useReducer = React.useReducer(loginReducer, initialLoginState),\n      _React$useReducer2 = _slicedToArray(_React$useReducer, 2),\n      loginState = _React$useReducer2[0],\n      dispatch = _React$useReducer2[1];\n\n  var authContext = React.useMemo(function () {\n    return {\n      signIn: function signIn(username, password) {\n        var url = \"http://10.0.2.2:8080/auth/login\";\n        axios.post(url, {\n          email: username,\n          password: password\n        }).then(function _callee(res) {\n          var data;\n          return _regeneratorRuntime.async(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  data = res.data;\n\n                  if (!data[\"token\"]) {\n                    _context.next = 11;\n                    break;\n                  }\n\n                  _context.prev = 2;\n                  _context.next = 5;\n                  return _regeneratorRuntime.awrap(AsyncStorage.setItem(\"userToken\", data[\"token\"]));\n\n                case 5:\n                  _context.next = 10;\n                  break;\n\n                case 7:\n                  _context.prev = 7;\n                  _context.t0 = _context[\"catch\"](2);\n                  Alert.alert(\"Invalid User!\", \"Your Username or Password is incorrect!\");\n\n                case 10:\n                  dispatch({\n                    type: \"LOGIN\",\n                    id: username,\n                    token: data[\"token\"]\n                  });\n\n                case 11:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, null, null, [[2, 7]], Promise);\n        }).catch(function (e) {\n          Alert.alert(\"Invalid User!\", \"Your Username or Password is incorrect!\");\n        });\n      },\n      signOut: function signOut() {\n        return _regeneratorRuntime.async(function signOut$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.prev = 0;\n                _context2.next = 3;\n                return _regeneratorRuntime.awrap(AsyncStorage.removeItem(\"userToken\"));\n\n              case 3:\n                _context2.next = 8;\n                break;\n\n              case 5:\n                _context2.prev = 5;\n                _context2.t0 = _context2[\"catch\"](0);\n                console.log(_context2.t0);\n\n              case 8:\n                dispatch({\n                  type: \"LOGOUT\"\n                });\n\n              case 9:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, null, null, [[0, 5]], Promise);\n      }\n    };\n  }, []);\n  React.useEffect(function () {\n    setTimeout(function _callee2() {\n      var userToken;\n      return _regeneratorRuntime.async(function _callee2$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              userToken = null;\n              _context3.prev = 1;\n              _context3.next = 4;\n              return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"userToken\"));\n\n            case 4:\n              userToken = _context3.sent;\n              _context3.next = 10;\n              break;\n\n            case 7:\n              _context3.prev = 7;\n              _context3.t0 = _context3[\"catch\"](1);\n              console.log(_context3.t0);\n\n            case 10:\n              dispatch({\n                type: \"RETRIEVE_TOKEN\",\n                token: userToken\n              });\n\n            case 11:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, null, [[1, 7]], Promise);\n    }, 1000);\n  }, []);\n\n  if (loginState.isLoading) {\n    return React.createElement(View, {\n      style: {\n        flex: 1,\n        justifyContent: \"center\",\n        alignItems: \"center\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 7\n      }\n    }, React.createElement(ActivityIndicator, {\n      size: \"large\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 9\n      }\n    }));\n  }\n\n  return React.createElement(AuthContext.Provider, {\n    value: authContext,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 5\n    }\n  }, React.createElement(NavigationContainer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 7\n    }\n  }, loginState.userToken == null ? React.createElement(MainTabScreen, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 11\n    }\n  }) : React.createElement(RootStackScreen, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 11\n    }\n  })));\n}\n\nexport default App;","map":{"version":3,"sources":["C:/Users/PC/Documents/hocnhieuchut/reactnative/mobile-app/App.js"],"names":["React","NavigationContainer","createDrawerNavigator","AsyncStorage","axios","MainTabScreen","HistoryScreen","GenerateQRScreen","SearchScreen","PromotionsScreen","SettingsScreen","SupportScreen","RootStackScreen","DrawerContent","AuthContext","Drawer","App","initialLoginState","isLoading","userName","userToken","loginReducer","prevState","action","type","token","id","useReducer","loginState","dispatch","authContext","useMemo","signIn","username","password","url","post","email","then","res","data","setItem","Alert","alert","catch","e","signOut","removeItem","console","log","useEffect","setTimeout","getItem","flex","justifyContent","alignItems"],"mappings":"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","sourcesContent":["import * as React from \"react\";\r\nimport { View, ActivityIndicator, Alert } from \"react-native\";\r\n\r\nimport { NavigationContainer } from \"@react-navigation/native\";\r\nimport { createDrawerNavigator } from \"@react-navigation/drawer\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport axios from \"axios\";\r\n\r\nimport MainTabScreen from \"./screens/RootDrawer/MainTabScreen\";\r\nimport HistoryScreen from \"./screens/RootDrawer/HistoryScreen\";\r\nimport GenerateQRScreen from \"./screens/RootDrawer/GenerateQRScreen\";\r\nimport SearchScreen from \"./screens/RootDrawer/SearchScreen\";\r\nimport PromotionsScreen from \"./screens/RootDrawer/PromotionsScreen\";\r\nimport SettingsScreen from \"./screens/RootDrawer/SettingsScreen\";\r\nimport SupportScreen from \"./screens/RootDrawer/SupportScreen\";\r\n\r\nimport RootStackScreen from \"./screens/RootStack/RootStackScreen\";\r\n\r\nimport { DrawerContent } from \"./screens/DrawerContent\";\r\n\r\nimport { AuthContext } from \"./components/context\";\r\n\r\nconst Drawer = createDrawerNavigator();\r\n\r\nfunction App() {\r\n  const initialLoginState = {\r\n    isLoading: true,\r\n    userName: null,\r\n    userToken: null,\r\n  };\r\n\r\n  const loginReducer = (prevState, action) => {\r\n    switch (action.type) {\r\n      case \"RETRIEVE_TOKEN\":\r\n        return {\r\n          ...prevState,\r\n          userToken: action.token,\r\n          isLoading: false,\r\n        };\r\n      case \"LOGIN\":\r\n        return {\r\n          ...prevState,\r\n          userName: action.id,\r\n          userToken: action.token,\r\n          isLoading: false,\r\n        };\r\n      case \"LOGOUT\":\r\n        return {\r\n          ...prevState,\r\n          userName: null,\r\n          userToken: null,\r\n          isLoading: false,\r\n        };\r\n    }\r\n  };\r\n\r\n  const [loginState, dispatch] = React.useReducer(\r\n    loginReducer,\r\n    initialLoginState\r\n  );\r\n\r\n  const authContext = React.useMemo(\r\n    () => ({\r\n      signIn: (username, password) => {\r\n        const url = \"http://10.0.2.2:8080/auth/login\";\r\n        // const url = \"https://server-user-srtknk-cxnam-ews.education.wise-paas.com/auth/login\";\r\n        axios\r\n          .post(url, {\r\n            email: username,\r\n            password: password,\r\n          })\r\n          .then(async (res) => {\r\n            const data = res.data;\r\n            if (data[\"token\"]) {\r\n              try {\r\n                await AsyncStorage.setItem(\"userToken\", data[\"token\"]);\r\n              } catch (e) {\r\n                Alert.alert(\r\n                  \"Invalid User!\",\r\n                  \"Your Username or Password is incorrect!\"\r\n                );\r\n              }\r\n              dispatch({ type: \"LOGIN\", id: username, token: data[\"token\"] });\r\n            }\r\n          })\r\n          .catch((e) => {\r\n            Alert.alert(\r\n              \"Invalid User!\",\r\n              \"Your Username or Password is incorrect!\"\r\n            );\r\n          });\r\n      },\r\n      signOut: async () => {\r\n        try {\r\n          await AsyncStorage.removeItem(\"userToken\");\r\n        } catch (e) {\r\n          console.log(e);\r\n        }\r\n        dispatch({ type: \"LOGOUT\" });\r\n      },\r\n    }),\r\n    []\r\n  );\r\n\r\n  React.useEffect(() => {\r\n    setTimeout(async () => {\r\n      let userToken = null;\r\n      try {\r\n        userToken = await AsyncStorage.getItem(\"userToken\");\r\n      } catch (e) {\r\n        console.log(e);\r\n      }\r\n      dispatch({ type: \"RETRIEVE_TOKEN\", token: userToken });\r\n    }, 1000);\r\n  }, []);\r\n\r\n  if (loginState.isLoading) {\r\n    return (\r\n      <View style={{ flex: 1, justifyContent: \"center\", alignItems: \"center\" }}>\r\n        <ActivityIndicator size=\"large\" />\r\n      </View>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <AuthContext.Provider value={authContext}>\r\n      <NavigationContainer>\r\n        {loginState.userToken == null ? (\r\n          <MainTabScreen />\r\n        ) : (\r\n          <RootStackScreen />\r\n        )}\r\n      </NavigationContainer>\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport default App;\r\n"]},"metadata":{},"sourceType":"module"}